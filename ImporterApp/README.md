# ImporterApp
統合商品データをステージングCSVから読み取り、マッピングルールに従って
Product モデルへ変換・登録・バリデーション・差分履歴管理を行うコンソールアプリです。

## 🔧 構成
ProductImporter/
├── ImporterApp/               ... 本体アプリケーション
│   ├── Models/                ... Productモデル、属性情報など
│   ├── Services/              ... 変換ロジック、バリデーションなど
│   ├── Infrastructure/        ... 疑似リポジトリ（メモリ保存など）
│   ├── Rules/                 ... 後で使用予定ルールまとめ
│   └── Program.cs             ... 実行エントリーポイント
├── staging.csv                ... 実行用CSV（自由に作成できます）
├── README.md                  ... このファイル
└──  ImporterApp.Tests/        ... 単体テストプロジェクト（xUnit）
    └── Tests/                 ... テストケース

## 実行方法
cd ImporterApp
dotnet run

## テスト実行方法
cd ImporterApp.Tests
dotnet test

## 実装されている主な処理
処理ステップ	説明
① CSV読み込み	CsvLoader によりステージングCSVをテスト商品データとして読み取り
② マッピング	ユースジIDから疑似ルールを取得し、カラム→属性IDの変換を実行
③ モデル変換	ImportService により Product モデルへ変換
④ バリデーション	ProductValidator による必須チェック
⑤ 差分比較・履歴保存	ProductDiffer・InMemoryProductRepository により履歴や更新を反映

## 注意点
・現在はすべてメモリ上で処理を完結しており、DB等の永続化は未実装です。
・InMemoryProductRepository は Infrastructure に存在する簡易リポジトリです。
・依存性注入やモックは未対応ですが、今後の拡張を見据えた命名に留意しています。

## 🛠 今後のTODO（機能拡張・運用対応）
商品データ取り込みシステムとして本格運用するため、以下の実装・整理が必要です。

# データ取込基盤
・ファイル取込ルール詳細マスタ × 項目定義マスタ によるステージングテーブルの自動生成
・ ステージングテーブルへのCSVファイルインポート処理（バルクインサート対応含む）
    ・ 取込時のCSV項目と項目リストマスタとの突合チェック
・リスト外項目は「レビュー待ち」として取込後フラグ管理
・ 取込ルールセットの組立処理
    ・ ファイル取込ルール詳細マスタ × 項目定義マスタ × ルール条件テーブル をもとに動的マッピング定義を生成

# 商品状態の構築と判別
・ルール条件テーブルを用いた「商品状態」の自動判別処理の実装
・商品状態コードの設計とステージング → マスタ反映時の判定ロジック設計

# 商品の差分比較と更新処理
・登録済商品との差分比較精度向上（属性の増減・変更・削除の検知）
・変更箇所に応じた履歴レコードの生成
・差分なし・差分あり・レビュー待ちの各ステータスフラグ対応

# カタログ管理
・カタログ識別ルールの取得処理実装
・カタログ識別ロジックの開発（用途、ブランド、カテゴリ等の組み合わせ判定）
・ 同一カタログ内での同一商品の特定・グルーピング処理

# その他将来対応
・ロジック単体化・ユニットテスト強化（バリデーション、差分判定、履歴生成など）
・永続化先の抽象化（RDB）と環境変数による切替

# バッチ処理対応（定時取込、リトライ制御）
・エラーログと取込結果サマリの出力（件数・エラー分類など）

# バッチ起動
・lambdaからの起動
